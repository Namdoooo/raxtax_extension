# Benchmark: Non Present Query

## Purpose
This benchmark evaluates how well the method handles queries that are
not present in the reference database. The objective is to assess whether 
the method is robust against overclassification when reference sequences are
missing.

## Benchmark Design
The benchmark is organized into multiple independent iterations.
For each iteration, a general reference dataset consisting of 1100 sequences 
is generated. Within each iteration, 10 tests are performed in which a reference
database is created by randomly removing 100 sequences from the general
reference dataset. The removed sequences are used to form the query set,
ensuring that none of the query sequences are present in the
corresponding reference database.

All parameters remain fixed across tests and iterations. A total of
5 iterations are performed.

## Data Generation
All input data used in this benchmark is generated automatically by 
the benchmark scripts. No external input data is required.

For each test, a new dataset is generated using random seeds. Within an
iteration, the general reference dataset is generated once, while each
test samples a new reference database by randomly excluding 100
sequences.

## Execution workflow
The benchmark execution is organized in multiple layers.

The `main.py` file in the benchmark root directory orchestrates the
execution of all iterations. For each iteration, it invokes the
corresponding `main.py` located in the iteration subdirectory.

The `main.py` file inside each iteration directory is identical across 
all iterations and is responsible for executing all tests within that 
iteration. For each iteration, the required directory structure for the 
individual tests is created automatically. At the beginning of each iteration,
a general reference directory is generated. 

For each test, the iteration-level `main.py` performs the following
steps:

1. Generates a configuration file and an executable to run the
   simulation.
2. Executes the simulation using the generated executable and
   configuration file.
3. Samples 100 sequences from the iteration-level reference dataset to
   form the query set, while the remaining sequences compose the
   reference database.
4. Executes the classification algorithm (raxtax extension) on the
   generated input data.

## How to Run
From the raxtax root directory, execute

```
python -m benchmarks_hits.missing_queries.main
```

After completion, analysis and plotting can be performed with:

```
python -m benchmarks_hits.missing_queries.analyze
```

## Output

### Per iteration
For each iteration, a general reference directory is generated that
serves as the basis for all tests within that iteration.

### Per test (within each iteration)
For each test run, the following directories and files are generated:

- `queries/`  
  Contains the generated query sequences used as input for the
  classification algorithm. This directory also includes intermediate
  files and log files produced during query generation.
- `references/`  
  Contains the generated reference data used for classification. This
  directory also includes intermediate files, log files, and a lookup
  table required by the classification algorithm.
- `results_*/`  
  Contains the classification results and a `metadata.out` file containing
  runtime measurements and classification statistics.

For archival purposes, the `queries/` and `references/` directories
generated by the benchmark were manually zipped together as
`dataset.tgz` to reduce storage requirements.

### After analysis
After executing the analysis script (`analyze.py`), the following
additional output files are generated:

- `aggregated_metadata.csv`  
  Aggregated metadata for all tests within a single iteration.
- `combined_metadata.csv`  
  Aggregated metadata across all iterations.

The analysis script also prints the numerical results reported in the
thesis to standard output. These values are not written to a file.

## Notes

The benchmark was executed using commit `00e3863446e994807e84e3dddd1a99c66b9b7a4e` of the `raxtax_extension`
repository.