# Benchmark: Average Branch Length vs. F1 Score

## Purpose
This benchmark evaluates the effect of varying the phylogenetic divergence
of the reference database. In the code, this parameter is
referred to as *tree height*; however, it acts as a scaling factor for
the average branch length of the simulated phylogenetic tree and does
not represent tree height in the phylogenetic sense. 

## Benchmark Design
The benchmark is organized into multiple independent iterations.
Within each iteration, the tree height is varied between 0.01 and 0.19
while all other parameters remain fixed. When generating the input data, 
the reference database is based on a phylogenetic tree with an original 
average branch length of 0.1. The tree height parameter determines the 
factor by which each branch length in the tree is multiplied when simulating 
the sequences. As a result, the average branch length of the reference database 
varies between 0.01 · 0.1 = 0.001 and 0.19 · 0.1 = 0.019. A total of 5 iterations 
are performed, with identical parameter settings across iterations.

## Data Generation
All input data used in this benchmark is generated automatically by 
the benchmark scripts. No external input data is required.

For each test, a new dataset is generated using random seeds.

## Execution workflow
The benchmark execution is organized in multiple layers.

The `main.py` file in the benchmark root directory orchestrates the
execution of all iterations. For each iteration, it invokes the
corresponding `main.py` located in the iteration subdirectory.

The `main.py` file inside each iteration directory is identical across
all iterations and is responsible for executing all tests within that
iteration. For each iteration, the required directory structure for the
individual tests is created automatically.

For each test, the iteration-level `main.py` performs the following
steps:

1. Generates a configuration file and an executable to run the
   simulation with the specified average branch length.
2. Executes the simulation using the generated executable and
   configuration file.
3. Generates the input data based on the configuration file.
4. Executes the classification algorithm (raxtax extension) on the
   generated input data.

## How to Run
From the raxtax root directory, execute

```
python -m benchmarks_hits.tree_height_benchmark.main
```

After completion, analysis and plotting can be performed with:

```
python -m benchmarks_hits.tree_height_benchmark.analyze
```

## Output

### Per test (within each iteration)
For each test run, the following directories and files are generated:

- `queries/`  
  Contains the generated query sequences used as input for the
  classification algorithm. This directory also includes intermediate
  files and log files produced during query generation.
- `references/`  
  Contains the generated reference data used for classification. This
  directory also includes intermediate files, log files, and a lookup
  table required by the classification algorithm.
- `results_*/`  
  Contains the classification results and a `metadata.out` file containing
  runtime measurements and classification statistics.

For archival purposes, the `queries/` and `references/` directories
generated by the benchmark were manually zipped together as
`dataset.tgz` to reduce storage requirements.

### After analysis
After executing the analysis script (`analyze.py`), the following
additional output files are generated:

- `aggregated_metadata.csv`  
  Aggregated metadata for all tests within a single iteration.
- `combined_metadata.csv`  
  Aggregated metadata across all iterations.
- `plots/`  
  Directory containing generated plots.
- `tree_height_vs_f1_score.pdf`  
  Final plot showing the relationship between average branch length and
  F1 score, used in the thesis.

## Notes
In the codebase, the parameter referred to as *tree height* does not
represent tree height in the phylogenetic sense. Instead, it is a
branch length scaling parameter that scales the initial average branch
length of 0.1 used for generating the reference sequences.

The benchmark was executed using commit `91b93629230b1d1d2d3be6157245cbd2477c1f71` of the `raxtax_extension`
repository.